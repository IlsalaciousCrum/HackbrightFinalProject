{% extends 'base.html' %}
{% block content %}  

<!-- Modals -->
<div class="modal fade" id="guestsModal" tabindex="-1" role="dialog" aria-labelledby="guestsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="guestsModalLabel">Manage the guest list</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class = "row round_hidden_div" style="padding-top: 2em">
                {% from "_formhelpers.html" import render_field %}
                    <form action="{{ url_for('profiles.manageguestlist') }}" class="form form-horizontal" method="post" role="form" id="manage_guest_list_form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <input type="hidden" name="party_id" value="{{  party.party_id  }}"/>
                        {{ render_field(manage_guests_form.friends) }}<br>
                        <input type="submit" class="btn btn-sm btn-info" value="Submit">&ensp;<button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Cancel</button>
                    </form>
                </div>  
            </div>
        </div>
        <script src="{{ url_for('static', filename = 'js/manageGuestList.js') }}" type="text/javascript"></script>
    </div>
</div>

<div class="modal fade" id="titleModal" tabindex="-1" role="dialog" aria-labelledby="changeTitleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changeTitleModalLabel">Change Party Title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class = "row round_hidden_div" style="padding-top: 2em">
                {% from "_formhelpers.html" import render_field %}
                    <form action="{{ url_for('profiles.changetitle') }}" class="form form-horizontal" method="post" role="form" id="changeTitle">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <input type="hidden" name="party_id" value="{{  party.party_id  }}"/>
                        {{ render_field(titleform.title,  style="width: 75%", rows="1") }}<br>
                        <input type="submit" class="btn btn-sm btn-info btn-default" value="Submit">&ensp;<button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Cancel</button>
                    </form>
                </div>  
            </div>
        </div>
         <script src="{{ url_for('static', filename = 'js/partyTitle.js') }}" type="text/javascript"></script>
    </div>
</div>


<div class="modal fade" id="dateTimeModal" tabindex="-1" role="dialog" aria-labelledby="datetimeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="datetimeModalLabel">Change Party Date and/or Time</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class = "row round_hidden_div" style="padding-top: 2em">
                <div id="ff-flashedalert"></div>

                <strong>Current date and time:</strong> <span class="dtm-dtm">{{ moment(party.datetime_of_party).format('LLLL') }}</span>

                {% from "_formhelpers.html" import render_field, render_inline_field %}
                    <form action="{{ url_for('profiles.party_datetime') }}" class="form form-horizontal" method="post" role="form" id="party_datetime">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <input type="hidden" name="party_id" value="{{  party.party_id  }}"/>
                        {{ render_field(datetimeform.date) }}<br>
                        {{ render_field(datetimeform.hour) }}<br>
                        <input type="submit" class="btn btn-sm btn-info" value="Submit">&ensp;<button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Cancel</button>
                    </form>
                </div>
            </div>
        </div>
        <script src="{{ url_for('static', filename = 'js/datetime.js') }}" type="text/javascript"></script>
    </div>
</div>

 <!-- End modals -->


<!-- Begin content -->

<h1 class="text-left" style="padding-left: 3em">{{  party.title  }}</h3>

    <div class="row well-spaced dashboard" style="padding-top: 3em">
        <div class="col-md-4 col-md-offset-1">      
            <div class = "row round_div" style="padding-top: 2em">

                <div class='lastUpdated'>
                    <div id='lastUpdated' class="text-muted small" style='padding-bottom: 1em'>
                        Last updated {{ moment(party.last_updated).format('LLLL') }}
                    </div>
                </div>
                <div class="partytitle">
                    <div id="partytitle">
                        <button type="button" class="btn btn-sm btn-default" data-toggle="modal" data-target="#titleModal">
                            <span class="glyphicon glyphicon-pencil text-info" title="Change the party title" aria-hidden="true"></span>
                        </button>&emsp; <strong>Title:</strong>&emsp;{{  party.title  }}
                    </div>
                </div>
                <div class="dtm">
                    <div id="dtm">
                        <button type="button" class="btn btn-sm btn-default" data-toggle="modal" title="Change the date or time of the party" data-target="#dateTimeModal">
                            <span class="glyphicon glyphicon-pencil text-info" aria-hidden="true"></span>
                        </button>&emsp; <strong>Date:</strong>&emsp;<span class="dtm-dtm">{{ moment(party.datetime_of_party).format('LLLL') }}</span>
                    </div>
                </div>
                <div class="noted">
                    <div id="notes">
                        <button type="button" class="btn btn-sm btn-default" data-toggle="modal" title="Change the notes for the party" data-target="#notesModal">
                            <span class="glyphicon glyphicon-pencil text-info" aria-hidden="true"></span>
                        </button>&emsp; <strong>Notes:</strong>&emsp;{{ party.party_notes }}
                    </div>
                </div>

                <div class="guests">
                    <div id="guests">

                        <h3>Guests
                        <button type="button" class="btn btn-sm btn-default" data-toggle="modal" data-target="#guestsModal">
                                Manage guest list
                            </button></h3>
                            
                            {% if party.guests %}
                                {% for guest in party.guests %}
                                {% if guest.profiles.profile_id != current_user.profile_id %}
                                <a href="{{ url_for('profiles.show_friend_profile', friend_id=guest.profiles.profile_id) }}">
                                <span style="font-size: 125%">{{  guest.profiles.first_name  }} {{  guest.profiles.last_name  }}</span></a> - <span class="text-muted">({{  guest.profiles.email  }})</span><br>
                                {% endif %}
                                {% endfor %}
                            {% else %}
                            No guests invited yet.
                            {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-5 col-md-offset-1">      
            <div class = "row round_div" style="padding-top: 2em">
                
                <div class='recipes'>
                    <div id="recipes" style="padding-top: 1em">
                        
                        <h3>Recipes</h3>
                        {% if party.recipes %}
                            {% for recipe in party.recipes %}
                                <a href="{{ url_for('spoonacular.show_saved_recipe', record_id=recipe.recipe_record_id) }}"><span style="font-size: 125%">{{ recipe.title }}</span></a><br>
                                Recipe works for:
                                <ul>
                                {% for guest in recipe.recipe_works_for %}
                                    <li>{{  guest.first_name  }} {{  guest.last_name  }}</a><span class="text-muted">({{  guest.email  }})</span></li>
                                {% endfor %}
                            </ul>
                            {% endfor %}
                        {% else %}
                            No recipes added yet for this party.
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}